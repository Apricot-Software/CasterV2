<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=2">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caster</title>
    <link rel="stylesheet" href="static/style/style.css">
</head>
<body>
    <div class="container">
        <div class="top-bar">
            <img src="static/img/casterlogo.png" width="50px">
        </div>
        <div class="content">
            <div class="left-bar">
                <a class="bar-button ab-text" onclick="window.location.href = '/'"><img src="static/img/home.png" class="bar-button-icon"><span class="bar-text">Home</span></a>
                <a class="bar-button ab-text" onclick="window.location.href = '/profile'"><img src="static/img/profile.png" class="bar-button-icon"><span class="bar-text">Profile</span></a>
                <a class="bar-button ab-text" onclick="window.location.href = '/search'"><img src="static/img/search.png" class="bar-button-icon"><span class="bar-text">Search</span></a>
                <a class="bar-button ab-text" onclick="window.location.href = '/create'"><img src="static/img/pencil.png" class="bar-button-icon"><span class="bar-text">Post</span></a>
                <a class="bar-button ab-text" onclick="window.location.href = '/settings'"><img src="static/img/settings.png" class="bar-button-icon"><span class="bar-text">Settings</span></a>
            </div>
            <div class="main-content">
                <div class="post-flex-box">
                    <div class="post-container">
                        <p class="user-bar">
                            <img class="user-pfp" src="{{ pfp }}">
                            <a class="display-name" href="/profile?user={{ handle }}">{{ displayName }}</a>
                            <img src="static/img/veri.png" style="width: 15px; display: {{ isveri }};">
                            <span class="handle">@{{ handle }} • {{ timestamp }}</span>
                        </p>
                        <p class="post-text">{{ postContent | safe }}</p>
                        <div class="post-action-bar">
                            <span>
                                <img src="static/img/like-unselect.png" class="like-icon">
                                <a class="ab-text">0</a>
                            </span>
                            <span>
                                <img src="static/img/message.png" class="like-icon">
                                <a class="ab-text">{{ replys }}</a>
                            </span>
                            <span>
                                <img src="static/img/share.png" class="like-icon">
                                <a class="ab-text">0</a>
                            </span>
                        </div>

                    </div>
                    <div class="poster-container">
                        <img class="user-pfp" src="{{ user_pfp }}"><div id="post-input" class="post-input" placeholder="Say something..." oninput="if(this.innerHTML.trim()==='<br>')this.innerHTML=''" contentEditable></div><button class="positiveButton post-text" id="sendButton" onclick="sendPost()">Post</button>
                    </div>

                </div>
                <div class="post-flex-box" id="post-flex-box">
                </div>
                <div class="post-flex-box">
                    <div class="post-container">
                        <p class="user-bar">
                            <img class="user-pfp" src="static/img/placeholder.jpg">
                            <a class="display-name" href="/profile?user={{ handle }}"><img class="user-pfp" style="width: 400px; height: 10px" src="static/img/placeholder.jpg"></a>
                            <span class="handle"></span>
                        </p>
                        <p class="post-text"><img class="user-pfp" style="width: 400px; height: 10px" src="static/img/placeholder.jpg"><br><img class="user-pfp" style="width: 200px; height: 10px" src="static/img/placeholder.jpg"></p>
                        <div class="post-action-bar">
                            <span>
                                <img src="static/img/placeholder.jpg" class="like-icon" style="border-radius: 50px;">
                                <a class="ab-text"></a>
                            </span>
                            <span>
                                <img src="static/img/placeholder.jpg" class="like-icon" style="border-radius: 50px;">
                                <a class="ab-text"></a>
                            </span>
                            <span>
                                <img src="static/img/placeholder.jpg" class="like-icon" style="border-radius: 50px;">
                                <a class="ab-text"></a>
                            </span>
                        </div>

                    </div>
                </div>
                <div class="post-flex-box">
                    <div class="post-container">
                        <p class="user-bar">
                            <img class="user-pfp" src="static/img/placeholder.jpg">
                            <a class="display-name" href="/profile?user={{ handle }}"><img class="user-pfp" style="width: 400px; height: 10px" src="static/img/placeholder.jpg"></a>
                            <span class="handle"></span>
                        </p>
                        <p class="post-text"><img class="user-pfp" style="width: 400px; height: 10px" src="static/img/placeholder.jpg"><br><img class="user-pfp" style="width: 200px; height: 10px" src="static/img/placeholder.jpg"></p>
                        <div class="post-action-bar">
                            <span>
                                <img src="static/img/placeholder.jpg" class="like-icon" style="border-radius: 50px;">
                                <a class="ab-text"></a>
                            </span>
                            <span>
                                <img src="static/img/placeholder.jpg" class="like-icon" style="border-radius: 50px;">
                                <a class="ab-text"></a>
                            </span>
                            <span>
                                <img src="static/img/placeholder.jpg" class="like-icon" style="border-radius: 50px;">
                                <a class="ab-text"></a>
                            </span>
                        </div>

                    </div>
                </div>
                <div class="post-flex-box">
                    <div class="post-container">
                        <p class="user-bar">
                            <img class="user-pfp" src="static/img/placeholder.jpg">
                            <a class="display-name" href="/profile?user={{ handle }}"><img class="user-pfp" style="width: 400px; height: 10px" src="static/img/placeholder.jpg"></a>
                            <span class="handle"></span>
                        </p>
                        <p class="post-text"><img class="user-pfp" style="width: 400px; height: 10px" src="static/img/placeholder.jpg"><br><img class="user-pfp" style="width: 200px; height: 10px" src="static/img/placeholder.jpg"></p>
                        <div class="post-action-bar">
                            <span>
                                <img src="static/img/placeholder.jpg" class="like-icon" style="border-radius: 50px;">
                                <a class="ab-text"></a>
                            </span>
                            <span>
                                <img src="static/img/placeholder.jpg" class="like-icon" style="border-radius: 50px;">
                                <a class="ab-text"></a>
                            </span>
                            <span>
                                <img src="static/img/placeholder.jpg" class="like-icon" style="border-radius: 50px;">
                                <a class="ab-text"></a>
                            </span>
                        </div>

                    </div>
                </div>
                <div class="post-flex-box">
                    <div class="post-container">
                        <p class="user-bar">
                            <img class="user-pfp" src="static/img/placeholder.jpg">
                            <a class="display-name"><img class="user-pfp" style="width: 400px; height: 10px" src="static/img/placeholder.jpg"></a>
                            <span class="handle"></span>
                        </p>
                        <p class="post-text"><img class="user-pfp" style="width: 400px; height: 10px" src="static/img/placeholder.jpg"><br><img class="user-pfp" style="width: 200px; height: 10px" src="static/img/placeholder.jpg"></p>
                        <div class="post-action-bar">
                            <span>
                                <img src="static/img/placeholder.jpg" class="like-icon" style="border-radius: 50px;">
                                <a class="ab-text"></a>
                            </span>
                            <span>
                                <img src="static/img/placeholder.jpg" class="like-icon" style="border-radius: 50px;">
                                <a class="ab-text"></a>
                            </span>
                            <span>
                                <img src="static/img/placeholder.jpg" class="like-icon" style="border-radius: 50px;">
                                <a class="ab-text"></a>
                            </span>
                        </div>

                    </div>
                </div>
                <div class="post-flex-box">
                    <div class="post-container">
                        <p class="user-bar">
                            <img class="user-pfp" src="static/img/placeholder.jpg">
                            <a class="display-name" href="/profile?user={{ handle }}"><img class="user-pfp" style="width: 400px; height: 10px" src="static/img/placeholder.jpg"></a>
                            <span class="handle"></span>
                        </p>
                        <p class="post-text"><img class="user-pfp" style="width: 400px; height: 10px" src="static/img/placeholder.jpg"><br><img class="user-pfp" style="width: 200px; height: 10px" src="static/img/placeholder.jpg"></p>
                        <div class="post-action-bar">
                            <span>
                                <img src="static/img/placeholder.jpg" class="like-icon" style="border-radius: 50px;">
                                <a class="ab-text"></a>
                            </span>
                            <span>
                                <img src="static/img/placeholder.jpg" class="like-icon" style="border-radius: 50px;">
                                <a class="ab-text"></a>
                            </span>
                            <span>
                                <img src="static/img/placeholder.jpg" class="like-icon" style="border-radius: 50px;">
                                <a class="ab-text"></a>
                            </span>
                        </div>

                    </div>
                </div>
                <div class="spacer"></div>
            </div>
            <div class="right-bar">
                <h1>Coming Soon</h1>
            </div>
        </div>
    </div>
</body>
<script>
    function sendPost() {
    const postContent = document.getElementById('post-input').innerText;
    const sendButton = document.getElementById('sendButton');
    sendButton.className = "positiveButtonDisabled";
    sendButton.setAttribute("disabled", "");

    if (postContent === '') {
        alert('Post content cannot be empty.');
        return
    }

    fetch('/api/sendreplypost?refid={{ post_id }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ content: postContent })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        if (data.postId) {
            window.location.href = `/post?id=${data.postId}`;
        } else {
            console.error('Post ID not found in response');
        }
    })
}
let currentPage = -1;
let isLoading = false;

function loadPosts() {
    if (isLoading) return;
    isLoading = true;

    currentPage++;
    fetch(`/api/replyposts?refid={{ post_id }}&page=${currentPage}`)
        .then(response => response.json())
        .then(posts => {
            const postsFlexBox = document.getElementById('post-flex-box');
            posts.forEach(post => {
                const postContainer = document.createElement('div');
                postContainer.className = 'post-container';
                postContainer.onclick = function(){ window.location.href = `/post?id=${post.postId}`; };

                const userBar = document.createElement('p');
                userBar.className = 'user-bar';
                postContainer.appendChild(userBar);

                const userpfp = document.createElement('img');
                userpfp.src = post.pfp;
                userpfp.className = 'user-pfp';
                userBar.appendChild(userpfp);

                const displayName = document.createElement('a');
                displayName.innerText = post.displayName;
                displayName.className = 'display-name';
                displayName.href = `/profile?user=${post.handle}`.replace('@', '')
                userBar.appendChild(displayName);

                if (post.isveri) {
                   const checkmark = document.createElement('img');
                   checkmark.src = 'static/img/veri.png';
                   checkmark.style.width = '15px';
                   userBar.appendChild(checkmark);
                };


                const handle = document.createElement('span');
                handle.innerText = `${post.handle} • ${post.timestamp}`;
                handle.className = 'handle';
                userBar.appendChild(handle);

                const postContent = document.createElement('p');
                postContent.innerHTML = `${post.postContent}`;
                postContent.className = 'post-text';
                postContainer.appendChild(postContent);

                const actionBar = document.createElement('div');
                actionBar.className = 'post-action-bar';
                postContainer.appendChild(actionBar);

                // Like action
                const likeContainer = document.createElement('span');
                actionBar.appendChild(likeContainer);

                const likeIcon = document.createElement('img');
                likeIcon.src = 'static/img/like-unselect.png';
                likeIcon.className = 'like-icon';
                likeContainer.appendChild(likeIcon);

                const likeCounter = document.createElement('a');
                likeCounter.innerText = post.likes || '0';
                likeCounter.className = 'ab-text';
                likeContainer.appendChild(likeCounter);

                // Comment action
                const commentContainer = document.createElement('span');
                actionBar.appendChild(commentContainer);

                const commentIcon = document.createElement('img');
                commentIcon.src = 'static/img/message.png';
                commentIcon.className = 'like-icon';
                commentContainer.appendChild(commentIcon);

                const commentCounter = document.createElement('a');
                commentCounter.innerText = post.comments || '0';
                commentCounter.className = 'ab-text';
                commentContainer.appendChild(commentCounter);

                // Share action
                const shareContainer = document.createElement('span');
                actionBar.appendChild(shareContainer);

                const shareIcon = document.createElement('img');
                shareIcon.src = 'static/img/share.png';
                shareIcon.className = 'like-icon';
                shareContainer.appendChild(shareIcon);

                const shareCounter = document.createElement('a');
                shareCounter.innerText = post.shares || '0';
                shareCounter.className = 'ab-text';
                shareContainer.appendChild(shareCounter);

                postsFlexBox.appendChild(postContainer);
            });

            isLoading = false;

        })
        .catch(error => console.error('Error fetching data:', error));
}
    document.addEventListener('DOMContentLoaded', loadPosts);

    const mainContent = document.querySelector('.main-content');


    mainContent.addEventListener('scroll', function() {
        if (mainContent.scrollTop + mainContent.clientHeight >= mainContent.scrollHeight - 1700) {
            console.log(mainContent.scrollTop + mainContent.clientHeight >= mainContent.scrollHeight - 100);
            loadPosts();
        }
    });
document.getElementById('post-input').addEventListener('paste', function(event) {
    event.preventDefault();

    // Get the pasted content from clipboard
    const clipboardData = event.clipboardData || window.clipboardData;
    let pastedData = clipboardData.getData('text');

    // Optionally, you can use HTML if you want to keep plain text and remove HTML formatting
    // let pastedData = clipboardData.getData('text/html') || clipboardData.getData('text');

    // Insert the cleaned text
    document.execCommand('insertHTML', false, pastedData);
});
</script>
</html>
